<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    .my-table {
      border: 1px solid #eee;
      width: 100%;
    }

    tr td {
      height: 40px;
      line-height: 40px;
      border-bottom: 1px solid #eee;
      padding-left: 30px;
    }

    th {
      height: 50px;
      line-height: 50px;
      border-bottom: 4px solid #eee;
    }

    tr:last-child td {
      border-bottom: 0;
    }

    .form {
      margin: auto;
      margin-bottom: 15px;
      width: 350px;
    }

    input {
      padding: 10px 10px;
      outline: none;
      display: block;
      margin-top: 15px;
      width: 350px;
    }
  </style>
  <script>
    function deleteItem(item) {
      fetch('/user/delete', {
        method: 'delete',
        headers: {
          'Content-Type': 'application/json',
        },
        body: item
      }).then(res => {
        res.json().then(data => {
          console.log(data && location.reload())
        })
      })
    }

    function submit() {
      const inputs = document.getElementsByTagName('input')
      const body = {}
      Array.from(inputs).forEach((ele, i) => {
        body[ele.name] = ele.value
      })
      if (body.address && body.age && body.email && body.phoneNo) {
        fetch('/user/save', {
          headers: {
            'Content-Type': 'application/json',
          },
          method: 'post',
          body: JSON.stringify(body)
        }).then(res => {
          res.json().then(data => {
            console.log(data && location.reload())
          })
        })
      }
    }

    function updateItem(item) {
      const obj = JSON.parse(item)
      Object.keys(obj).forEach(key => {
        console.log(key)
        if (document.getElementsByName(key)[0]) {
          document.getElementsByName(key)[0].value = obj[key]
        }

      })
    }
  </script>
</head>

<body>
  <div class="form">
    <input name="name" required placeholder="è¯·è¾“å…¥å§“å" type="text">
    <input name="email" required type="email" placeholder="è¯·è¾“å…¥é‚®ç®±">
    <input name="phoneNo" required pattern="^1[3456789]\d{9}$" placeholder="è¯·è¾“å…¥æ‰‹æœºå·ç ">
    <input name="age" required type="number" placeholder="è¯·è¾“å…¥å¹´é¾„">
    <input name="address" required placeholder="è¯·è¾“å…¥å®¶åº­åœ°å€">
    <button onclick="submit()">æäº¤æ•°æ®</button>
  </div>
  <table class="my-table">
    <thead class="head">
      <tr>
        <td>ç¼–å·</td>
        <td>å§“å</td>
        <td>å¹´é¾„</td>
        <td>æ‰‹æœºå·ç ğŸ“±</td>
        <td>é‚®ç®±ğŸ“®</td>
        <td>åœ°å€ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</td>
        <td>å…¥å­¦æ—¶é—´ğŸ˜¸</td>
        <td>æ“ä½œğŸ”§</td>
      </tr>
    </thead>
    <tbody>
      <% users.data.records.forEach((elem, index) => { %>
      <tr>
        <td><%= elem.id %></td>
        <td><%= elem.name %></td>
        <td><%= elem.age %></td>
        <td><%= elem.phoneNo %></td>
        <td><%= elem.email %></td>
        <td><%= elem.address %></td>
        <td><%= new Date(elem.created).toLocaleDateString() %></td>
        <td>
          <button onclick="deleteItem(`<%=JSON.stringify(elem)%>`)">åˆ é™¤</button>
          <button onclick="updateItem(`<%=JSON.stringify(elem)%>`)">ä¿®æ”¹</button>
        </td>
      </tr>
      <%})%>
      <tr>
        <td>æ€»æ¡æ•°</td>
        <td colspan="6"><%= users.data.count %></td>
      </tr>
    </tbody>
  </table>



</body>

</html>